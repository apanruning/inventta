<!DOCTYPE html>
{%  load tagging_tags pagination_tags gravatar banner_tags urlparser %}
<html lang='es'>
<head>
    <meta charset="utf-8" />
    <title>ltmo . {% block title %}{{title}}{% endblock %}</title>
    <link rel="icon" type="image/png" href="/media/favicon.ico" />

    <meta name="description" content="LTMO, un sitio para procastinar en todos los niveles que sea imaginable." />
    <meta name="google-site-verification" content="GzD0PcJhPHGZ1BcTySo8BLEqEQNObvIqqMXSjqVeh4w" />
    <link title="LTMO - Derrames publicados recientemente" href="/feed/" type="application/rss+xml" rel="alternate">
    <link rel="stylesheet" href="/media/style.css" type="text/css" media="screen" />    
    <link rel="stylesheet" href="/media/code.css" type="text/css" media="screen" />    
    <script src="/media/jquery.js"></script>
    <script src="/media/ui.js"></script>
    <script type="text/javascript" language="javascript">
    (function( $ ) {

    $( ".ui-autocomplete-input" ).live( "autocompleteopen", function() {
        var autocomplete = $( this ).data( "autocomplete" ),
            menu = autocomplete.menu;
        menu.activate( $.Event({ type: "mouseenter" }), menu.element.children().first() );
    });

    }( jQuery ));
    $(document).ready(function(){
        var hash = window.location.hash;
        if (hash){
            $(window).scrollTop($(hash).offset().top-55)
        }
        
		function split( val ) {
			return val.split( /,\s*/ );
		}
		function extractLast( term ) {
			return split( term ).pop();
		}

        $('.control').click(function(){
            target = $(this).attr('href');
            $(target).toggle('blind', 300);
            if (target === '#leak-form'){
                window.setTimeout(function(){
                    $('#id_description').focus();
                },400)

            }
            return false;
            
        });
        $('.edit').click(function(){
            url = $(this).attr('href');
            $.getJSON(url, function(data){
                $('#leak-form').attr('action', url);
                form_fields = $('#leak-form :input');
                for (x in data) {
                    $('#id_'+x).val(data[x]);
                }
                console.log(data);
            });
            $('#leak-form').show('blind', 300);
            return false;
        })
		$( "#id_tags" )
			// don't navigate away from the field on tab when selecting an item
			.bind( "keydown", function( event ) {
				if ( event.keyCode === $.ui.keyCode.TAB &&
						$( this ).data( "autocomplete" ).menu.active ) {
					event.preventDefault();
				}
			})
			.autocomplete({
				source: function( request, response ) {
					$.getJSON( "{% url tags %}", {
						tag_name: extractLast( request.term )
					}, response );
				},
				search: function() {
					var term = extractLast( this.value );
					if ( term.length < 2 ) {
						return false;
					}
				},
				focus: function() {
					return false;
				},
				select: function( event, ui ) {
					var terms = split( this.value );
					terms.pop();
					terms.push( ui.item.value );
					terms.push( "" );
					this.value = terms.join( ", " );
					return false;
				}
			});
            window.setTimeout(function(){
                $('#messages .control').click()
                }, 1000);
    })
    </script>
</head>
<body>
<div id="wrapper">
{% if messages %}
<ul id="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}<a class="control" href="#messages">X</a></li>
    {% endfor %}
</ul>
{% endif %}
<header>
    <a href="#leak-form" id="new-leak" class="control" title="Nunca sobra un poco de aceite"><em>+</em> derramá que el aceite es gratis</a>
    <h1 id="logo">
    <a href="http://{{request.get_host}}" title="Volver a la raiz">ltmo/</a>{% if tag %}<a href="/{{tag|slugify}}" title="Hay {{object_list.count}} derrames con esta etiqueta">{{tag}}</a>{% endif %}{% if author %}<a href="~{{author}}">~{{author}}</a>{% endif %}
    </h1>
    {% include 'leak_form.html' %}
</header>

<div id="main">
{% block main %}
    <section>
    {% block content %}
    {% autopaginate object_list 10 %}
    {% for object in object_list %}
        <article>
            {% if object.title %}
            <h1><a href="{{object.get_absolute_url}}">{{object.title}}</a></h1>    
            {% endif %}
            {{object.rendered|safe|truncatewords_html:'150'}}
            {% tags_for_object object as tag_list %}
            <details>
                <a href="/~{{object.author}}">~{{object.author}}</a>, 
                {{object.created|date}}, 
                {% for tag in tag_list %}<a href="/{{tag|slugify}}" class="tags">{{tag}}</a>, {%endfor%}           
                <a title="permalink" class="permalink" href="{{object.get_absolute_url}}">#</a>
                {{object.metadata}}
                {% if user.is_staff %}<a href="{{object.get_absolute_url}}" class="edit">!</a>{% endif %}
            </details>
        </article>
        {% if forloop.counter == 5 %}{% pop_slot 'content' %}{% endif %}
    {% empty %}<h2>Nadie derramó nada aún</h2>
    {% endfor %}
    {% paginate %}
    {% endblock %}
    </section>
     <aside>

        <h3>¿Qué es lo que observa?</h3>
        <p>Nunca hay suficiente redundancia para garantizar la continuidad de la información.</p>
        <p>Probablemente sea momento de llegar a una definición de derrame, ¿qué definimos por perder-mucho-aceite?.</p>
        <h3>Nube</h3>    
        {% tag_cloud_for_model ltmo.Leak as cloud with steps=20 distribution=linear %}
        {% for tag in cloud %}
        <a href="/{{tag}}" 
           style="font-size:{{tag.font_size|add:'8'}}pt"
           title="{{tag.count}} derrames">{{tag}}</a>
        {% endfor %}
        {% tags_for_model ltmo.Leak as leak_tags with counts %}
        {% pop_slot 'aside' %}
    </aside>
    

    <br class="clear"/>
{% endblock %}
</div>

<footer>
        <p><a href="http://twitter.com/lossingoil">Seguinos en twitter</a> o <a href="mailto://loosingtoomuchoil@gmail.com">mandanos a trabajar</a>, pero igual revisá el <a href="{{repository.url}}">Código fuente</a> que todavía tenemos {{repository.open_issues}} issues, y de los {{repository.watchers}} culiados que miran el repositorio ninguno nos da una mano</p>
</footer>
</div>

</body>
    {% pop_slot 'analytics' %}
    
    <!-- 
      _______    
     |   __  \
     |  |  |  |
     |   ··   |
     |   __  /
     |  |
 __  |__| __
 \  \    /  /
  \  \  /  /
   \  \/  /
    \    /
     \__/
 -->
</html>
